# Claude Code API Gateway Configuration
# Copy this file to .env and customize with your settings

# ====== AUTHENTICATION ======
# Enable API key authentication (set to true for production)
REQUIRE_AUTH=true

# API Keys (comma-separated list)
# Generate secure keys using: openssl rand -hex 32
# Example: API_KEYS=key1,key2,key3
API_KEYS=

# ====== SERVER CONFIGURATION ======
# Server host and port
HOST=127.0.0.1
PORT=8010

# Debug mode (set to false in production)
DEBUG=false

# ====== CLAUDE CONFIGURATION ======
# Path to Claude Code CLI binary (auto-detected if not set)
# CLAUDE_BINARY_PATH=/usr/local/bin/claude

# Default model for Claude Code
DEFAULT_MODEL=claude-3-5-sonnet-20241022

# Maximum concurrent Claude sessions
MAX_CONCURRENT_SESSIONS=10

# Session timeout in minutes
SESSION_TIMEOUT_MINUTES=30

# ====== CLAUDE API KEY MANAGEMENT ======
# Multiple API Keys for automatic rotation (JSON format)
# The system automatically rotates keys when quota is exceeded or errors occur
# Each key should have: name, token, base_url, status

# ⚠️  IMPORTANT: Replace with your real API keys before using
# Get Claude API keys from: https://console.anthropic.com/
# Or use third-party providers like: https://anyrouter.top

CLAUDE_API_KEYS='[
  {
    "name": "primary",
    "token": "sk-your-primary-claude-api-key-here",
    "base_url": "https://anyrouter.top",
    "status": "active"
  },
  {
    "name": "backup1", 
    "token": "sk-your-backup-claude-api-key-1-here",
    "base_url": "https://anyrouter.top",
    "status": "active"
  },
  {
    "name": "backup2",
    "token": "sk-your-backup-claude-api-key-2-here", 
    "base_url": "https://anyrouter.top",
    "status": "active"
  }
]'

# Auto-rotate keys when quota/auth errors detected
CLAUDE_AUTO_ROTATE=true

# Automatically update shell config files (.bashrc, .bash_profile, .zshrc) with new keys
# This ensures the new key is available for direct Claude CLI usage
CLAUDE_RESTART_ON_ROTATE=false

# Current active key index (managed automatically - do not modify)
CLAUDE_CURRENT_KEY_INDEX=0

# ====== KEY ROTATION FEATURES ======
# When a Claude API key fails due to insufficient quota:
# 1. ✅ Automatically detects quota/auth/rate-limit errors
# 2. ✅ Rotates to the next available backup key
# 3. ✅ Updates environment variables (ANTHROPIC_AUTH_TOKEN)
# 4. ✅ Updates shell configuration files automatically
# 5. ✅ Continues serving API requests without interruption
# 6. ✅ Logs all key rotation events for monitoring

# ====== PROJECT CONFIGURATION ======
# Root directory for Claude projects
PROJECT_ROOT=/tmp/claude_projects

# Maximum project size in MB
MAX_PROJECT_SIZE_MB=1000

# Cleanup interval in minutes
CLEANUP_INTERVAL_MINUTES=60

# ====== DATABASE CONFIGURATION ======
# Database URL (SQLite by default)
DATABASE_URL=sqlite:///./claude_api.db

# ====== LOGGING CONFIGURATION ======
# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Log format (json or text)
LOG_FORMAT=json

# ====== CORS CONFIGURATION ======
# Allowed origins (comma-separated, * for all)
ALLOWED_ORIGINS=*

# Allowed methods (comma-separated, * for all)
ALLOWED_METHODS=*

# Allowed headers (comma-separated, * for all)
ALLOWED_HEADERS=*

# ====== RATE LIMITING ======
# Requests per minute per API key/IP
RATE_LIMIT_REQUESTS_PER_MINUTE=100

# Burst limit for rate limiting
RATE_LIMIT_BURST=10

# ====== STREAMING CONFIGURATION ======
# Streaming chunk size in bytes
STREAMING_CHUNK_SIZE=1024

# Streaming timeout in seconds
STREAMING_TIMEOUT_SECONDS=300
